version: '3'

services:
  cert-builder:
    container_name: cert-builder
    build: .
    volumes:
      - certs:/root/certs/:rw

  nginx-main:
    container_name: nginx-main
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - certs:/etc/nginx/certs/:ro
    ports:
      - "4443:443"

  nginx-tls1-1:
    container_name: nginx-tls1-1
    image: nginx:alpine
    volumes:
      - ./nginx-tls1-1.conf:/etc/nginx/conf.d/default.conf
      - certs:/etc/nginx/certs/:ro
    ports:
      - "4444:443"

  nginx-tls1-2:
    container_name: nginx-tls1-2
    image: nginx:alpine
    volumes:
      - ./nginx-tls1-2.conf:/etc/nginx/conf.d/default.conf
      - certs:/etc/nginx/certs/:ro
    ports:
      - "4445:443"

  nginx-tls1-3:
    container_name: nginx-tls1-3
    image: nginx:alpine
    volumes:
      - ./nginx-tls1-3.conf:/etc/nginx/conf.d/default.conf
      - certs:/etc/nginx/certs/:ro
    ports:
      - "4446:443"

volumes:
  certs: